<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta charset="utf-8" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/globals.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styleguide_profile.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style_profile.css') }}" />
  </head>
  <body>
    <div class="my-account">
      <div class="navigation-bar">
        <div class="logo">
          <p class="element"><span class="text-wrapper">V1nTag6</span> <span class="span">.</span></p>
        </div>
        <div class="elements-navigation">
          <button class="button-wrapper">
            <button class="button">
              <div class="content"><div class="get-started">Home</div></div>
            </button>
          </button>
          <div class="div-wrapper">
            <button class="content-wrapper">
              <div class="content"><div class="div">Shop</div></div>
            </button>
          </div>
          <div class="div-wrapper">
            <button class="content-wrapper">
              <div class="content"><div class="div">Product</div></div>
            </button>
          </div>
          <button class="button-wrapper">
            <button class="content-wrapper">
              <div class="content"><div class="div">Contact Us</div></div>
            </button>
          </button>
        </div>
        <div class="icons">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M18.5 18.5L22 22M21 11.5C21 6.25329 16.7467 2 11.5 2C6.25329 2 2 6.25329 2 11.5C2 16.7467 6.25329 21 11.5 21C16.7467 21 21 16.7467 21 11.5Z"
                    stroke="#141718" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
            </svg>

            
            <a href="{{ url_for('main.profile') }}" style="text-decoration: none;">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                        d="M18.5588 19.5488C17.5654 16.8918 15.0036 15 12 15C8.99638 15 6.4346 16.8918 5.44117 19.5488M18.5588 19.5488C20.6672 17.7154 22 15.0134 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 15.0134 3.33285 17.7154 5.44117 19.5488M18.5588 19.5488C16.8031 21.0756 14.5095 22 12 22C9.49052 22 7.19694 21.0756 5.44117 19.5488M15 9C15 10.6569 13.6569 12 12 12C10.3431 12 9 10.6569 9 9C9 7.34315 10.3431 6 12 6C13.6569 6 15 7.34315 15 9Z"
                        stroke="#141718" stroke-width="1.5" stroke-linejoin="round" />
                </svg>

            </a>
          <div class="elements-navigation-2">
            <div class="frame">
                <div class="text-wrapper-2">{{ cart_items|length }}</div>
            </div> <!-- Hiển thị số lượng sản phẩm trong giỏ -->
            <a href="{{ url_for('main.cart') }}" style="text-decoration: none;">
                <svg width="50" height="28" viewBox="0 0 50 28" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <g clip-path="url(#clip0_386_3156)">
                        <circle cx="40" cy="14" r="10" fill="#141718" />
                        <path
                            d="M36.9281 18V16.6705L40.0346 13.794C40.2988 13.5384 40.5204 13.3082 40.6994 13.1037C40.8812 12.8991 41.019 12.6989 41.1127 12.5028C41.2065 12.304 41.2534 12.0895 41.2534 11.8594C41.2534 11.6037 41.1951 11.3835 41.0787 11.1989C40.9622 11.0114 40.8031 10.8679 40.6014 10.7685C40.3997 10.6662 40.171 10.6151 39.9153 10.6151C39.6483 10.6151 39.4153 10.669 39.2164 10.777C39.0176 10.8849 38.8642 11.0398 38.7562 11.2415C38.6483 11.4432 38.5943 11.6832 38.5943 11.9616H36.8429C36.8429 11.3906 36.9721 10.8949 37.2306 10.4744C37.4892 10.054 37.8514 9.72869 38.3173 9.49858C38.7832 9.26847 39.3201 9.15341 39.9281 9.15341C40.5531 9.15341 41.0971 9.2642 41.5602 9.4858C42.0261 9.70455 42.3883 10.0085 42.6468 10.3977C42.9054 10.7869 43.0346 11.233 43.0346 11.7358C43.0346 12.0653 42.9693 12.3906 42.8386 12.7116C42.7108 13.0327 42.4821 13.3892 42.1525 13.7812C41.823 14.1705 41.3585 14.6378 40.7591 15.1832L39.4849 16.4318V16.4915H43.1497V18H36.9281Z"
                            fill="white" />
                    </g>
                    <path d="M10 8L10 9C10 10.6569 11.3431 12 13 12C14.6569 12 16 10.6569 16 9V8" stroke="#141718" stroke-width="1.5"
                        stroke-linecap="round" stroke-linejoin="round" />
                    <path
                        d="M16.6113 5H9.38836C7.433 5 5.76424 6.41365 5.44278 8.3424L3.77612 18.3424C3.36976 20.7805 5.24994 23 7.72169 23H18.278C20.7498 23 22.6299 20.7805 22.2236 18.3424L20.5569 8.3424C20.2355 6.41365 18.5667 5 16.6113 5Z"
                        stroke="#141718" stroke-width="1.5" stroke-linejoin="round" />
                    <defs>
                        <clipPath id="clip0_386_3156">
                            <rect width="20" height="20" fill="white" transform="translate(30 4)" />
                        </clipPath>
                    </defs>
                </svg>
            </a>
          </div>
        </div>
      </div>
      <div class="content-2">
        <div class="title"><div class="text-wrapper-3">My Account</div></div>
        <div class="account-section">
          <div class="MENU">
            <div class="frame-2">
              <div class="elements-menu-avatar">
                <div class="avatar"></div>
                <div class="icon-box">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M4.2508 3.72265C4.09763 3.95241 4.15972 4.26285 4.38948 4.41603C4.61924 4.5692 4.92968 4.50711 5.08285 4.27735L4.2508 3.72265ZM5.60434 2.59373L6.02037 2.87108V2.87108L5.60434 2.59373ZM10.396 2.59373L10.812 2.31638L10.396 2.59373ZM10.9175 4.27735C11.0706 4.50711 11.3811 4.5692 11.6108 4.41603C11.8406 4.26285 11.9027 3.95241 11.7495 3.72265L10.9175 4.27735ZM9.50016 9C9.50016 9.82843 8.82859 10.5 8.00016 10.5V11.5C9.38087 11.5 10.5002 10.3807 10.5002 9H9.50016ZM8.00016 10.5C7.17174 10.5 6.50016 9.82843 6.50016 9H5.50016C5.50016 10.3807 6.61945 11.5 8.00016 11.5V10.5ZM6.50016 9C6.50016 8.17157 7.17174 7.5 8.00016 7.5V6.5C6.61945 6.5 5.50016 7.61929 5.50016 9H6.50016ZM8.00016 7.5C8.82859 7.5 9.50016 8.17157 9.50016 9H10.5002C10.5002 7.61929 9.38087 6.5 8.00016 6.5V7.5ZM5.08285 4.27735L6.02037 2.87108L5.18832 2.31638L4.2508 3.72265L5.08285 4.27735ZM6.71374 2.5H9.28658V1.5H6.71374V2.5ZM9.97996 2.87108L10.9175 4.27735L11.7495 3.72265L10.812 2.31638L9.97996 2.87108ZM9.28658 2.5C9.56521 2.5 9.82541 2.63925 9.97996 2.87108L10.812 2.31638C10.472 1.80635 9.89957 1.5 9.28658 1.5V2.5ZM6.02037 2.87108C6.17492 2.63925 6.43511 2.5 6.71374 2.5V1.5C6.10076 1.5 5.52834 1.80635 5.18832 2.31638L6.02037 2.87108ZM4.00016 4.5H12.0002V3.5H4.00016V4.5ZM14.1668 6.66667V11.3333H15.1668V6.66667H14.1668ZM12.0002 13.5H4.00016V14.5H12.0002V13.5ZM1.8335 11.3333V6.66667H0.833496V11.3333H1.8335ZM4.00016 13.5C2.80355 13.5 1.8335 12.53 1.8335 11.3333H0.833496C0.833496 13.0822 2.25126 14.5 4.00016 14.5V13.5ZM14.1668 11.3333C14.1668 12.53 13.1968 13.5 12.0002 13.5V14.5C13.7491 14.5 15.1668 13.0822 15.1668 11.3333H14.1668ZM12.0002 4.5C13.1968 4.5 14.1668 5.47005 14.1668 6.66667H15.1668C15.1668 4.91777 13.7491 3.5 12.0002 3.5V4.5ZM4.00016 3.5C2.25126 3.5 0.833496 4.91777 0.833496 6.66667H1.8335C1.8335 5.47005 2.80355 4.5 4.00016 4.5V3.5Z"
                            fill="#FEFEFE" />
                    </svg>

                </div>
              </div>
              <div class="text-wrapper-4" id="display-name">
                {{ session.display_name or 'Display name' }}
              </div>
            </div>
            <div class="frame-3">
              <div class="elements"><div class="menu-item">Account</div></div>
            <a href="{{ url_for('auth.logout') }}" style="text-decoration: none; color: inherit;">
                <div class="menu-item-wrapper">
                    <div class="menu-item-2">Log Out</div>
                </div>
            </a>
            </div>
          </div>
          <div class="detail">
            <div class="form">
              <div class="text-wrapper-5">Update Account Details</div>
              <div class="div-2">
                <label class="text-wrapper-6" for="input-1">FIRST NAME *</label>
                <div class="input"><input class="icon-input" placeholder="First name" type="text" id="input-1" /></div>
              </div>
              <div class="div-2">
                <label class="text-wrapper-6" for="input-2">LAST NAME *</label>
                <div class="input"><input class="icon-input" placeholder="Last name" type="text" id="input-2" /></div>
              </div>
              <div class="div-2">
                <div class="display-name">DISPLAY NAME *</div>
                <div class="input">
                  <input class="icon-input" placeholder="Display name" type="text" id="display-name-input"
                    value="{{ session.display_name or session.full_name or '' }}" />
                </div>
                <p class="p">This will be how your name will be displayed in the account section and in reviews</p>
              </div>
              <div class="div-2">
                <label class="text-wrapper-6" for="input-3">EMAIL *</label>
                <div class="input"><input class="icon-input" placeholder="Email" type="email" id="input-3" /></div>
              </div>
            </div>
            <button class="show-more-wrapper" id="save-profile-btn">
              <div class="show-more">Save changes</div>
            </button>
            <div class="form">
              <div class="text-wrapper-5">Password</div>
              <div class="div-2">
                <div class="text-wrapper-6">OLD PASSWORD</div>
                <div class="input">
                  <div class="your-email-wrapper">
                    <input class="icon-input" placeholder="Old password" type="password" id="old-password" />
                  </div>
                </div>
              </div>
              <div class="div-2">
                <div class="text-wrapper-6">NEW PASSWORD</div>
                <div class="input">
                  <div class="your-email-wrapper">
                    <input class="icon-input" placeholder="New password" type="password" id="new-password" />
                </div>
                </div>
              </div>
              <div class="div-2">
                <div class="repeat-NEW-PASSWORD">REPEAT NEW PASSWORD</div>
                <div class="input">
                    <input class="icon-input" placeholder="Repeat new password" type="password" id="confirm-password" />
                </div>
              </div>
              <button class="show-more-wrapper"><div class="show-more" id="save-password-btn">Save changes</div></button>
            </div>
          </div>
        </div>
      </div>
      <footer class="footer">
        <div class="footer-content">
          <div class="logo-and-links">
            <div class="logo-and-slogan">
              <div class="logo">
                <p class="element"><span class="text-wrapper-7">V1nTag6</span> <span class="span">.</span></p>
              </div>
              <div class="rectangle"></div>
              <div class="gift-decoration">Gift &amp; Decoration Store</div>
            </div>
            <div class="nav">
              <div class="text-wrapper-8">Home</div>
              <div class="text-wrapper-8">Shop</div>
              <div class="text-wrapper-8">Product</div>
              <div class="text-wrapper-8">Blog</div>
              <div class="text-wrapper-8">Contact Us</div>
            </div>
          </div>
        </div>
        <div class="bottom-bar">
          <div class="copyright">
            <p class="text-wrapper-9">Copyright © 2025 V1nTag6. All rights reserved</p>
            <div class="text-wrapper-10">Privacy Policy</div>
            <div class="text-wrapper-10">Terms of Use</div>
          </div>
          <div class="social-icon">
            <div class="img">
              <div class="vector"></div>
              <div class="vector-2"></div>
              <div class="vector-3"></div>
            </div>
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M18 3H15C12.2386 3 10 5.23858 10 8V10H6V14H10V21H14V14H18V10H14V8C14 7.44772 14.4477 7 15 7H18V3Z"
                    stroke="#FEFEFE" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <rect x="2" y="3" width="20" height="18" rx="4" stroke="#FEFEFE" stroke-width="1.5" />
                <path
                    d="M10.4472 8.72361L15.2111 11.1056C15.9482 11.4741 15.9482 12.5259 15.2111 12.8944L10.4472 15.2764C9.78231 15.6088 9 15.1253 9 14.382V9.61803C9 8.87465 9.78231 8.39116 10.4472 8.72361Z"
                    stroke="#FEFEFE" stroke-width="1.5" stroke-linecap="round" />
            </svg>
          </div>
        </div>
      </footer>
    </div>
    <script>
        document.getElementById('save-password-btn').addEventListener('click', function () {
            // Lấy giá trị từ các trường input
            const oldPassword = document.getElementById('old-password').value;
            const newPassword = document.getElementById('new-password').value;
            const confirmPassword = document.getElementById('confirm-password').value;

            // Kiểm tra validation
            if (!oldPassword || !newPassword || !confirmPassword) {
                alert('Please fill in all password fields!');
                return;
            }

            if (newPassword !== confirmPassword) {
                alert('New passwords do not match!');
                return;
            }

            if (newPassword.length < 6) {
                alert('New password must be at least 6 characters long!');
                return;
            }

            // Gửi request đến server
            fetch('{{ url_for("auth.change_password") }}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    old_password: oldPassword,
                    new_password: newPassword
                })
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('Password changed successfully!');
                        // Reset form
                        document.getElementById('old-password').value = '';
                        document.getElementById('new-password').value = '';
                        document.getElementById('confirm-password').value = '';
                    } else {
                        alert('Error: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('An error occurred while changing password.');
                });
        });

        // Xử lý lưu thông tin profile
          document.getElementById('save-profile-btn').addEventListener('click', function () {
            const firstName = document.getElementById('input-1').value;
            const lastName = document.getElementById('input-2').value;
            const displayName = document.getElementById('display-name-input').value;
            const email = document.getElementById('input-3').value;

            // Kiểm tra validation
            if (!firstName || !lastName || !displayName || !email) {
              alert('Please fill in all required fields!');
              return;
            }

            // Gửi request đến server để cập nhật profile
            fetch('{{ url_for("main.update_profile") }}', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({
                first_name: firstName,
                last_name: lastName,
                display_name: displayName,
                email: email
              })
            })
              .then(response => response.json())
              .then(data => {
                if (data.success) {
                  alert('Profile updated successfully!');
                  // Cập nhật tên hiển thị ngay lập tức
                  document.getElementById('display-name').textContent = displayName;
                  // Cập nhật session để khi reload vẫn giữ giá trị mới
                  if (data.session_updated) {
                    location.reload(); // Hoặc chỉ reload nếu cần
                  }
                } else {
                  alert('Error: ' + data.message);
                }
              })
              .catch(error => {
                console.error('Error:', error);
                alert('An error occurred while updating profile.');
              });
          });
    </script>
  </body>
</html>
